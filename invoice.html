<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Invoice</title>
  <style>
    :root { --bg:#0b1220; --card:#121a2b; --muted:#a9b3c9; --text:#e6ebf5; --accent:#4f8cff; --border:#22304c; --shadow:0 10px 30px rgba(0,0,0,.35);}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial;background:radial-gradient(1200px 800px at 10% -10%, #1b2743 0%, #0b1220 40%),radial-gradient(1200px 800px at 110% 10%, #1a2036 0%, #0b1220 40%),var(--bg);color:var(--text)}
    .wrap{max-width:1000px;margin:32px auto 60px;padding:0 16px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0));border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow)}
    .card .body{padding:20px}
    .head{display:flex;justify-content:space-between;align-items:start;gap:16px}
    .brand{font-weight:800;letter-spacing:.6px;font-size:22px}
    .muted{color:var(--muted)}
    table{width:100%;border-collapse:collapse;margin-top:14px}
    th,td{text-align:left;padding:10px;border-bottom:1px dashed var(--border)}
    th{color:var(--muted);font-weight:600;width:220px}
    .right{text-align:right}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px;justify-content:flex-end}
    button{border:0;padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:600;background:var(--accent);color:#fff;box-shadow:var(--shadow)}
    button.secondary{background:transparent;border:1px solid var(--border);color:var(--text)}
    button.success{background:#22c55e}
    @media print{
      body{background:#fff}
      .actions{display:none!important}
      .card{box-shadow:none;border:0}
      .card .body{padding:0}
    }
    .error{max-width:1000px;margin:40px auto;color:#fff;background:#9a1c1c;border:1px solid #d33;border-radius:12px;padding:14px 16px}
    tfoot td{border-bottom:0}
  </style>
</head>
<body>
  <div id="error" class="error" style="display:none"></div>
  <div class="wrap">
    <section class="card">
      <div class="body">
        <div class="head">
          <div>
            <div class="brand" id="hotelBrand">Hotel</div>
            <div class="muted" id="hotelAddr">Address</div>
          </div>
          <div class="muted">Issue Date: <span id="invDate"></span></div>
        </div>

        <table>
          <tbody>
            <tr><th>Guest Name</th><td id="vGuestName"></td></tr>
            <tr><th>Guest Address</th><td id="vGuestAddress"></td></tr>
            <tr><th>Meal Type</th><td id="vMeals"></td></tr>
            <tr><th>Check-in</th><td id="vIn"></td></tr>
            <tr><th>Check-out</th><td id="vOut"></td></tr>
            <tr><th>Nights</th><td id="vNights"></td></tr>
          </tbody>
        </table>

        <h3>Rooms</h3>
        <table id="roomsTable">
          <thead>
            <tr>
              <th>Room No</th>
              <th>View</th>
              <th>Type</th>
              <th class="right">Rate (Tk)</th>
            </tr>
          </thead>
          <tbody id="roomsBody"></tbody>
          <tfoot>
            <tr>
              <th colspan="3" class="right">Per-night Subtotal</th>
              <td id="perNightSubtotal" class="right"></td>
            </tr>
            <tr style="font-weight:800">
              <th colspan="3" class="right">Total (Nights Ã— Subtotal)</th>
              <td id="grandTotal" class="right"></td>
            </tr>
          </tfoot>
        </table>

        <div class="actions">
          <button id="btnPrint" class="success" type="button">Print / Save PDF</button>
          <a id="editLink" href="index.html" class="secondary" style="text-decoration:none;display:inline-block;padding:12px 16px;border-radius:12px;border:1px solid var(--border)">Edit Details</a>
        </div>
      </div>
    </section>
  </div>

  <script>
    const $ = s => document.querySelector(s);
    const toLocal = d => new Date(d).toLocaleDateString(undefined, {year:'numeric',month:'short',day:'2-digit'});
    const nightsBetween = (a,b)=>Math.max(0, Math.round((new Date(b)-new Date(a))/(24*60*60*1000)));

    function loadFromQuery(){
      const p = new URLSearchParams(location.search);
      const get = k => (p.get(k)||'').trim();
      const hotelName = get('hotelName');
      const hotelAddress = get('hotelAddress');
      const guestName = get('guestName');
      const guestAddress = get('guestAddress');
      const meals = get('meals');
      const ci = get('checkin');
      const co = get('checkout');
      let rooms = [];
      try { rooms = JSON.parse(p.get('rooms') || '[]'); } catch(e){ rooms = []; }

      if(!hotelName||!hotelAddress||!guestName||!guestAddress||!ci||!co||!rooms.length){
        return showErr('Missing details. Please go back and fill the form.');
      }
      const n = nightsBetween(ci, co);
      if(n <= 0) return showErr('Check-out must be after Check-in.');

      // Header
      $('#hotelBrand').textContent = hotelName;
      $('#hotelAddr').textContent = hotelAddress;
      $('#vGuestName').textContent = guestName;
      $('#vGuestAddress').innerHTML = guestAddress.replace(/\\n/g,'<br>');
      $('#vMeals').textContent = meals || 'No meals selected';
      $('#vIn').textContent = toLocal(ci);
      $('#vOut').textContent = toLocal(co);
      $('#vNights').textContent = `${n} night${n>1?'s':''}`;
      $('#invDate').textContent = toLocal(new Date());

      // Rooms
      const body = $('#roomsBody');
      body.innerHTML = '';
      let perNight = 0;
      for(const r of rooms){
        const rateNum = Number(r.rate || 0);
        perNight += isFinite(rateNum) ? rateNum : 0;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.roomNo || ''}</td>
          <td>${r.roomView || ''}</td>
          <td>${r.roomType || ''}</td>
          <td class="right">${(isFinite(rateNum)?rateNum:0).toLocaleString()} Tk</td>
        `;
        body.appendChild(tr);
      }
      $('#perNightSubtotal').textContent = `${perNight.toLocaleString()} Tk`;
      $('#grandTotal').textContent = `${(perNight * n).toLocaleString()} Tk`;

      // Edit link preserves data
      $('#editLink').href = `index.html?${p.toString()}`;
    }

    function showErr(msg){
      const e = $('#error');
      e.style.display = 'block';
      e.textContent = msg;
    }

    $('#btnPrint').addEventListener('click', ()=>window.print());
    loadFromQuery();
  </script>
</body>
</html>
